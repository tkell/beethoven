<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>What We Talk About When We Talk About Beethoven</title>

    <!-- <link href="css/main.css" rel="stylesheet"> -->
</head>

<body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src='remix.js'></script>

<script type="text/javascript">


function trim (str) {
    return str.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
}

function info(str) {
    $("#info").text(str);
}



// the md5 is 1ce90444c07f989f2b2b09d97cc87d43 for the record
var apiKey = 'WOUHTN44BMS5SMPF2';
var trackID = 'TRKXYVL13F72A49B87';
var trackURL = 'audio/beethoven_7_I.mp3'

var remixer;
var player;
var track;


var startingText = "...what do you think of the Seventh Symphony?";
var easterEggs = ['roll over']


function parseInput(theString) {
    letters = theString.split('');
    words = theString.split(' ');

    console.log(letters);
    console.log(words);

    var microchunks = Array();
    for (var i = 0; i < letters.length; i++ ) {
        if (letters[i] == "a") {
            console.log("yep");
            microchunks.push(track.analysis.beats[15]);
        }
        
    }
    console.log("playing...");
    console.log(microchunks);

    player.play(0, microchunks);
}

$(document).ready(function(){
    $("#textarea-input").val(startingText);

    // load things into remix
    var context = new webkitAudioContext();
    remixer = createJRemixer(context, $, apiKey);
    player = remixer.getPlayer();
    info("Loading analysis data...");

    remixer.remixTrackById(trackID, trackURL, function(t, percent) {
            track = t;

            info(percent + "% of the track loaded...");
            if (track.status == 'ok') {
                info('Ready!');
            }

        });


    // Take user input, update the UI, and parse the input
    $("#textarea-input").keyup(function(e) {
        if(e.which == 13) {
            var theString = $("#textarea-input").val();
            theString = trim(theString);

            var currentText = $('#text-log').html();
            var textArray = currentText.split('<br>');
            if (textArray.length > 10) {
                 textArray.shift();   
            }

            currentText = ''
            for (var i = 0; i < textArray.length; i++) {
                currentText = currentText + textArray[i] + '<br>';
            }

            var newHtml = currentText + theString
            $('#text-log').html(newHtml);
            $("#textarea-input").val("");

            parseInput(theString);
        }
    });
});

</script>

<div id="title">
     <h2>What We Talk About When We Talk About Beethoven</h2>
</div>

<div id="splash-image">
    <img src="splash.jpg">
</div>


<div id="text-log">
</div>

<div id="text-input">
    <textarea id="textarea-input" rows="7" cols="60">
    </textarea>
</div>

<div id="buttons">
</div>

<div id="about">
<p> What We Talk About When We Talk About Beethoven is a piece for human and human, or human and chatbot.</p>
<p> WWTAWWTAB works best in Chrome.</p>
</div>

<div id="info">
</div>

</body>

</html>